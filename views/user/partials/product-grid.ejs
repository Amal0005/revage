<% if (products && products.length > 0) { %>
    <% products.forEach(function(product) { %>
        <div class="product-card">
            <div class="product-image">
                <% if (user) { %>
                    <button class="wishlist-btn" onclick="toggleWishlist('<%= product._id %>')">
                        <i class="far fa-heart"></i>
                    </button>
                <% } %>
                <a href="/product-details?id=<%= product._id %>">
                    <img src="<%= product.images[0] %>" alt="<%= product.productName %>">
                </a>
            </div>
            <div class="product-info">
                <h3 class="product-name">
                    <a href="/product-details?id=<%= product._id %>"><%= product.productName %></a>
                </h3>
                <div class="product-price">
                    <% if (product.productOffer || (product.category && product.category.categoryOffer)) { %>
                        <% const totalOffer = (product.productOffer || 0) + (product.category?.categoryOffer || 0); %>
                        <% const discountedPrice = product.price * (1 - totalOffer/100); %>
                        <span class="original-price">₹<%= product.price.toFixed(2) %></span>
                        <span class="current-price">₹<%= discountedPrice.toFixed(2) %></span>
                        <span class="discount-badge">-<%= totalOffer %>%</span>
                    <% } else { %>
                        <span class="current-price">₹<%= product.price.toFixed(2) %></span>
                    <% } %>
                </div>
                <% if (product.averageRating > 0) { %>
                    <div class="product-rating">
                        <% for(let i = 1; i <= 5; i++) { %>
                            <% if (i <= Math.floor(product.averageRating)) { %>
                                <i class="fas fa-star"></i>
                            <% } else if (i - 0.5 <= product.averageRating) { %>
                                <i class="fas fa-star-half-alt"></i>
                            <% } else { %>
                                <i class="far fa-star"></i>
                            <% } %>
                        <% } %>
                        <span>(<%= product.ratings.length %>)</span>
                    </div>
                <% } %>
                <button class="add-to-cart-btn" onclick="addToCart('<%= product._id %>')">
                    Add to Cart
                </button>
            </div>
        </div>
    <% }); %>
<% } else { %>
    <div class="no-products">
        <p>No products found.</p>
    </div>
<% } %>
