<%- include("../../views/partials/admin/header") %>

<style>
    .sidebar {
            width: 260px;
            height: 100vh;
            position: fixed;
            background: #ffffff;
            border-right: 1px solid #e5e5e5;
            transition: width 0.3s ease;
        }

        .sidebar:hover {
            width: 280px;
        }

        .brand {
            padding: 2rem;
            border-bottom: 1px solid #e5e5e5;
        }

        .brand-title {
            font-size: 1.5rem;
            font-weight: 200;
            letter-spacing: 0.2em;
            color: #000000;
            text-decoration: none;
        }

        .nav-menu {
            padding: 1rem;
        }

        .nav-item {
            list-style: none;
            margin: 0.5rem 0;
        }
      

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem;
            color: #000000;
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background-color: #000000;
            color: #ffffff;
        }

        .nav-link i {
            width: 1.5rem;
            margin-right: 1rem;
        }

        .nav-link.active {
            background-color: #000000;
            color: #ffffff;
        }
    .orders-container {
        background-color: #ffffff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    .page-title {
        color: #000000;
        font-weight: 700;
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .table-container {
        background-color: #ffffff;
        border-radius: 10px;
        border: 1px solid #e5e5e5;
    }
    .table {
        margin-bottom: 0;
        width: 100%;
        background-color: #ffffff;
    }
    .table thead {
        background-color: #ffffff;
        border-bottom: 1px solid #e5e5e5;
    }
    .table th {
        color: #000000;
        font-weight: 600;
        padding: 1rem;
        border: none;
        font-size: 0.95rem;
    }
    .table td {
        color: #000000;
        padding: 1rem;
        vertical-align: middle;
        border-top: 1px solid #e5e5e5;
    }
    .table tbody tr:hover {
        background-color: #f8f8f8;
    }
    .status-select {
        padding: 0.5rem;
        border: 1px solid #e5e5e5;
        border-radius: 6px;
        background-color: #ffffff;
        color: #000000;
        font-size: 0.9rem;
        width: 140px;
        cursor: pointer;
    }
    .status-select:focus {
        outline: none;
        border-color: #000000;
    }
    .order-id {
        font-weight: 600;
        color: #000000;
    }
    .order-date {
        color: #000000;
    }
    .order-amount {
        font-weight: 600;
        color: #000000;
    }
    .view-details {
        text-decoration: none;
        color: #000000;
        padding: 0.5rem 1rem;
        border: 1px solid #000000;
        border-radius: 6px;
        transition: all 0.3s ease;
        display: inline-block;
        font-size: 0.9rem;
        background-color: #ffffff;
    }
    .view-details:hover {
        background-color: #000000;
        color: #ffffff;
    }
    .header-section {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e5e5e5;
    }
</style>


<div class="container-fluid">
    <div class="row">
        <main class="col-md-12 px-md-4">
            <div class="orders-container mt-4">
                <div class="header-section">
                    <h1 class="page-title">Order Management</h1>
                </div>

                <div class="table-container">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% orders.forEach(order => { %>
                                    <tr>
                                        <td><span class="order-id">#<%= order._id.toString().slice(-6).toUpperCase() %></span></td>
                                        <td><%= order.user.name %></td>
                                        <td class="order-date">
                                            <%= order.orderDate ? new Date(order.orderDate).toLocaleDateString('en-IN', { 
                                                year: 'numeric', 
                                                month: 'short', 
                                                day: 'numeric',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) : 'Date not available' %>
                                        </td>
                                        <td class="order-amount">â‚¹<%= order.totalAmount.toFixed(2) %></td>
                                        <td>
                                            <select class="status-select" data-order-id="<%= order._id %>">
                                                <option value="Pending" <%= order.status === 'Pending' ? 'selected' : '' %>>Pending</option>
                                                <option value="Processing" <%= order.status === 'Processing' ? 'selected' : '' %>>Processing</option>
                                                <option value="Shipped" <%= order.status === 'Shipped' ? 'selected' : '' %>>Shipped</option>
                                                <option value="Delivered" <%= order.status === 'Delivered' ? 'selected' : '' %>>Delivered</option>
                                                <option value="Cancelled" <%= order.status === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
                                                <option value="Return Requested" <%= order.status === 'Return Requested' ? 'selected' : '' %>>Return Requested</option>
                                                <option value="Returned" <%= order.status === 'Returned' ? 'selected' : '' %>>Returned</option>
                                            </select>
                                        </td>
                                        <td>
                                            <a href="/admin/orders/<%= order._id %>" class="view-details">View Details</a>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const statusSelects = document.querySelectorAll('.status-select');
    
    statusSelects.forEach(select => {
        select.addEventListener('change', async function() {
            const orderId = this.dataset.orderId;
            const newStatus = this.value;
            
            try {
                const response = await fetch('/admin/orders/update-status', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        orderId: orderId,
                        status: newStatus
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Success!',
                        text: 'Order status updated successfully',
                        icon: 'success',
                        confirmButtonColor: '#000000'
                    });
                } else {
                    throw new Error('Failed to update status');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                Swal.fire({
                    title: 'Error!',
                    text: 'Failed to update order status',
                    icon: 'error',
                    confirmButtonColor: '#000000'
                });
            }
        });
    });
});
</script>

<%- include("../../views/partials/admin/footer") %>
